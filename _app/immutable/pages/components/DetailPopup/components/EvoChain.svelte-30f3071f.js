import{S as _,i as g,s as w,w as E,x as y,y as b,q as u,o as d,B as C,e as k,c as q,a as x,d as m,b as N,g as j,p as S,n as B}from"../../../../chunks/index-b677f905.js";import G from"./EvoChainNode.svelte-1cfb5d4f.js";import{u as R}from"../../../../chunks/fetch-34339cb9.js";import{f as U}from"../../../../chunks/index-8db074b0.js";import"../../../../chunks/styles-b21c726b.js";import"../../../../chunks/isObjectLike-a1b535b6.js";import"../../../../chunks/_commonjsHelpers-850449cf.js";import"../../../../chunks/_arrayMap-2f79ae2a.js";import"../../../../chunks/isSymbol-fd7712af.js";import"../../../../chunks/index-1a6731ea.js";import"../../../../chunks/tslib-2c74db2e.js";import"../../../../chunks/preload-helper-936e422d.js";async function D(r){if(!r.url)throw new Error("missing evolution chain resource url");const t=await R.getResourceByUrl(r.url);let n=0;const e=[],o=[],i=[[null,t.chain]];do{const[s,l]=i.shift(),a={no:I(l.species.url),root:s===null,id:n++};if(e.push(a),s&&l.evolution_details.length){const f=l.evolution_details[0],v={from:s.id,to:a.id,detail:f};o.push(v)}i.push(...l.evolves_to.map(f=>[a,f]))}while(i.length);return{nodes:e,edges:o}}function F(r){const t=r.nodes.find(e=>e.root);if(!t)throw new Error("invalid target to build evolution graph");const n=r.edges.filter(e=>e.from===t.id).map(e=>p(e,r));return{detail:null,node:t,next:n}}function p(r,t){const n=t.nodes.find(o=>o.id===r.to);if(!n)throw new Error("invalid target to build graph node");const e=t.edges.filter(o=>o.from===n.id).map(o=>p(o,t));return{node:n,detail:r.detail,next:e.length?e:void 0}}function I(r){const t=r.match(/pokemon-species\/(\d+)\/?$/);if(!t)throw new Error("invalid pokemon species resource url");return U(+t[1])}function h(r){let t,n;return t=new G({props:{node:r[0]}}),{c(){E(t.$$.fragment)},l(e){y(t.$$.fragment,e)},m(e,o){b(t,e,o),n=!0},p(e,o){const i={};o&1&&(i.node=e[0]),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){C(t,e)}}}function V(r){let t,n,e=r[0]&&h(r);return{c(){t=k("div"),e&&e.c(),this.h()},l(o){t=q(o,"DIV",{class:!0});var i=x(t);e&&e.l(i),i.forEach(m),this.h()},h(){N(t,"class","evo-chain svelte-qjuw6v")},m(o,i){j(o,t,i),e&&e.m(t,null),n=!0},p(o,[i]){o[0]?e?(e.p(o,i),i&1&&u(e,1)):(e=h(o),e.c(),u(e,1),e.m(t,null)):e&&(B(),d(e,1,1,()=>{e=null}),S())},i(o){n||(u(e),n=!0)},o(o){d(e),n=!1},d(o){o&&m(t),e&&e.d()}}}function z(r,t,n){let{url:e=void 0}=t,{no:o=null}=t,{form:i}=t,s=null;return r.$$set=l=>{"url"in l&&n(1,e=l.url),"no"in l&&n(2,o=l.no),"form"in l&&n(3,i=l.form)},r.$$.update=()=>{r.$$.dirty&14&&e&&o&&D({url:e,no:o,form:i}).then(l=>{const c=F(l);console.log(c),n(0,s=c)})},[s,e,o,i]}class Y extends _{constructor(t){super(),g(this,t,z,V,w,{url:1,no:2,form:3})}}export{Y as default};
