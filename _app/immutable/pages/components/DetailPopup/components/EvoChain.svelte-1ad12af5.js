import{S as _,i as g,s as w,w as E,x as y,y as b,q as u,o as f,B as C,e as k,c as q,a as x,d as m,b as N,g as j,p as S,n as B}from"../../../../chunks/index-3bc5192d.js";import G from"./EvoChainNode.svelte-2891d2cf.js";import{u as R}from"../../../../chunks/fetch-0131095a.js";import{f as U}from"../../../../chunks/index-e864ac84.js";import"../../../../chunks/index-1a6731ea.js";import"../../../../chunks/tslib-2c74db2e.js";import"../../../../chunks/_commonjsHelpers-850449cf.js";import"../../../../chunks/preload-helper-936e422d.js";async function D(r){if(!r.url)throw new Error("missing evolution chain resource url");const t=await R.getResourceByUrl(r.url);let o=0;const e=[],n=[],i=[[null,t.chain]];do{const[l,s]=i.shift(),c={no:I(s.species.url),root:l===null,id:o++};if(e.push(c),l&&s.evolution_details.length){const a=s.evolution_details[0],p={from:l.id,to:c.id,detail:a};n.push(p)}i.push(...s.evolves_to.map(a=>[c,a]))}while(i.length);return{nodes:e,edges:n}}function F(r){const t=r.nodes.find(e=>e.root);if(!t)throw new Error("invalid target to build evolution graph");const o=r.edges.filter(e=>e.from===t.id).map(e=>v(e,r));return{detail:null,node:t,next:o}}function v(r,t){const o=t.nodes.find(n=>n.id===r.to);if(!o)throw new Error("invalid target to build graph node");const e=t.edges.filter(n=>n.from===o.id).map(n=>v(n,t));return{node:o,detail:r.detail,next:e.length?e:void 0}}function I(r){const t=r.match(/pokemon-species\/(\d+)\/?$/);if(!t)throw new Error("invalid pokemon species resource url");return U(+t[1])}function h(r){let t,o;return t=new G({props:{node:r[0]}}),{c(){E(t.$$.fragment)},l(e){y(t.$$.fragment,e)},m(e,n){b(t,e,n),o=!0},p(e,n){const i={};n&1&&(i.node=e[0]),t.$set(i)},i(e){o||(u(t.$$.fragment,e),o=!0)},o(e){f(t.$$.fragment,e),o=!1},d(e){C(t,e)}}}function V(r){let t,o,e=r[0]&&h(r);return{c(){t=k("div"),e&&e.c(),this.h()},l(n){t=q(n,"DIV",{class:!0});var i=x(t);e&&e.l(i),i.forEach(m),this.h()},h(){N(t,"class","evo-chain svelte-qjuw6v")},m(n,i){j(n,t,i),e&&e.m(t,null),o=!0},p(n,[i]){n[0]?e?(e.p(n,i),i&1&&u(e,1)):(e=h(n),e.c(),u(e,1),e.m(t,null)):e&&(B(),f(e,1,1,()=>{e=null}),S())},i(n){o||(u(e),o=!0)},o(n){f(e),o=!1},d(n){n&&m(t),e&&e.d()}}}function z(r,t,o){let{url:e=void 0}=t,{no:n=null}=t,{form:i}=t,l=null;return r.$$set=s=>{"url"in s&&o(1,e=s.url),"no"in s&&o(2,n=s.no),"form"in s&&o(3,i=s.form)},r.$$.update=()=>{r.$$.dirty&14&&e&&n&&D({url:e,no:n,form:i}).then(s=>{const d=F(s);o(0,l=d)})},[l,e,n,i]}class Q extends _{constructor(t){super(),g(this,t,z,V,w,{url:1,no:2,form:3})}}export{Q as default};
